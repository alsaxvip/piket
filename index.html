<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIKET 8D</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --green: #4CAF50;
            --white: #FFFFFF;
            --yellow: #FFC107;
            --light-grey: #f2f2f2;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--light-grey);
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: var(--white);
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--green);
            margin: 0;
            font-size: 2.2em;
        }

        #piket-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--light-grey);
            border-radius: 5px;
            border-left: 5px solid var(--yellow);
        }

        .info-item strong {
            color: var(--green);
        }

        .info-item span {
            display: block;
            margin-top: 5px;
        }

        .hidden {
            display: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }

        table th {
            background-color: var(--green);
            color: var(--white);
            text-transform: uppercase;
        }

        table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        table tr:hover {
            background-color: #f1f1f1;
        }

        #loading {
            text-align: center;
            font-size: 1.2em;
            color: #666;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PIKET 8D</h1>
        </header>

        <section id="loading">
            loading data...
        </section>

        <section id="piket-info" class="hidden">
            <div class="info-item">
                <strong>HARI:</strong> <span id="piket-day"></span>
            </div>
            <div class="info-item">
                <strong>TANGGAL:</strong> <span id="piket-date"></span>
            </div>
        </section>

        <section id="piket-schedule" class="hidden">
            <table id="piket-table">
                <thead>
                    <tr>
                        <th>TUGAS</th>
                        <th>PETUGAS</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </section>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vR0aRAL1eeeIq5GC-nxExaQWyxG5em_W_Vf1Fug5E1AdqfITNqYGYMzCj7vrMR68WdKbnQOiNDY28Oa/pub?gid=1092300572&single=true&output=csv';
        let fullPiketData = []; // Store all parsed rows from CSV

        const loadingSection = document.getElementById('loading');
        const piketInfoSection = document.getElementById('piket-info');
        const piketScheduleSection = document.getElementById('piket-schedule');
        const piketTableBody = document.querySelector('#piket-table tbody');
        const piketDaySpan = document.getElementById('piket-day');
        const piketDateSpan = document.getElementById('piket-date');

        // Column indices for the names in the CSV (0-indexed)
        // A=0, B=1, C=2, D=3, E=4, F=5, G=6, H=7, I=8, J=9, K=10, L=11
        const taskColumnIndices = {
            'ANGKAT BANGKU_1': 2, // Corresponds to column C
            'ANGKAT BANGKU_2': 3, // Still column C, just next row for the second 'angkat bangku'
            'LAP JENDELA': 4,    // Column C
            'BUANG SAMPAH': 5,   // Column C
            'PAPAN TULIS & KOLONG MEJA': 6, // Column C
            'BOX HP DAN PANGGIL GURU': 7, // Column C
            'MENYAPU_1': 8,      // Column C
            'MENYAPU_2': 9,      // Column C
            'MENGEPEL_1': 10,     // Column C
            'MENGEPEL_2': 11      // Column C
        };

        const tasksList = [
            'ANGKAT BANGKU',
            'ANGKAT BANGKU',
            'LAP JENDELA',
            'BUANG SAMPAH',
            'PAPAN TULIS & KOLONG MEJA',
            'BOX HP DAN PANGGIL GURU',
            'MENYAPU',
            'MENYAPU',
            'MENGEPEL',
            'MENGEPEL'
        ];

        async function fetchCSVData() {
            loadingSection.classList.remove('hidden');
            try {
                const response = await fetch(CSV_URL);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const csvText = await response.text();
                parseCSV(csvText);
            } catch (error) {
                console.error('Error fetching CSV:', error);
                // Optionally display an error message on the page
            } finally {
                loadingSection.classList.add('hidden');
            }
        }

        function parseCSV(csv) {
            const lines = csv.split('\n').filter(line => line.trim() !== '');

            if (lines.length < 3) { // Need at least header + 2 data rows (Hari/Tanggal row + first piket row)
                console.warn('CSV data is empty or malformed.');
                return;
            }

            // Store all data rows (skipping header)
            fullPiketData = lines.slice(1).map(line => line.split(',').map(cell => cell.trim()));
            displayPiketSchedule();
        }

        function displayPiketSchedule() {
            piketInfoSection.classList.remove('hidden');
            piketScheduleSection.classList.remove('hidden');

            const today = new Date();
            const optionsDay = { weekday: 'long' };
            const optionsDate = { day: 'numeric', month: 'long' };
            const todayDay = today.toLocaleDateString('id-ID', optionsDay); // e.g., "Sabtu"
            const todayDate = today.toLocaleDateString('id-ID', optionsDate); // e.g., "2 Agustus"

            piketDaySpan.textContent = todayDay;
            piketDateSpan.textContent = todayDate;

            piketTableBody.innerHTML = ''; // Clear previous data

            // Find the row in fullPiketData that matches today's day and date
            let relevantPiketRow = null;
            // Iterate from the second row of the data (index 1 of fullPiketData, which is row 2 of original sheet)
            // since A2 and B2 are the day and date, and names start from row 3 (index 2 of fullPiketData)
            for (let i = 0; i < fullPiketData.length; i++) {
                const row = fullPiketData[i];
                if (row[0].toLowerCase() === todayDay.toLowerCase() && row[1].toLowerCase() === todayDate.toLowerCase()) {
                    relevantPiketRow = row;
                    break;
                }
            }

            if (relevantPiketRow) {
                let taskCounter = {}; // To handle duplicate task names like "ANGKAT BANGKU"

                tasksList.forEach((taskName, index) => {
                    const row = piketTableBody.insertRow();
                    const taskCell = row.insertCell();
                    const petugasCell = row.insertCell();

                    taskCell.textContent = taskName;

                    // Determine which column to pick the name from based on the task and its order
                    // Since all tasks (C3-L12) are in separate rows in the spreadsheet,
                    // we need to pick the name from the corresponding row for that task.
                    // The 'relevantPiketRow' now contains the data for the matched day/date.
                    // The names for "ANGKAT BANGKU (first)", "ANGKAT BANGKU (second)", etc.,
                    // are in subsequent rows in the *original* spreadsheet, but they are all in
                    // the *same column* (column C, D, E, etc., as per your example) for a given day.
                    // The challenge description: "Angkat Bangku C3, Angkat Bangku C4, ... Mengepel L12"
                    // This means for a given day (e.g., Saturday), the first "Angkat Bangku" person is in column C
                    // of the row for that day, the second "Angkat Bangku" person is in column D, etc.
                    // My previous interpretation was that C3 was the first name, C4 the second etc regardless of row,
                    // which is incorrect based on your clarification "Data dimulai dari baris kedua. Contoh Hari berada di A2, Tanggal B2, Angkat Bangku c3, Angkat Bangku c4, dan begitu seterusnya sampai mengepel di l2".

                    // Let's re-evaluate column mapping based on the clarified structure:
                    // A2: Hari, B2: Tanggal
                    // C3: Angkat Bangku 1, C4: Angkat Bangku 2 ... up to L12 for Mengepel 2
                    // This means for a *specific day/date (A2/B2)*, the names are in a *single row* from C2 to L2.
                    // So, we need to find the specific row in the CSV that matches `todayDay` and `todayDate`.
                    // And then, from that specific row, we extract the names from columns C through L.

                    // Adjust column indexing for the *current row* that matches today's date
                    // C is index 2, D is index 3, ..., L is index 11
                    const columnIndicesForTasksInRow = [
                        2, // ANGKAT BANGKU (first) - C
                        3, // ANGKAT BANGKU (second) - D
                        4, // LAP JENDELA - E
                        5, // BUANG SAMPAH - F
                        6, // PAPAN TULIS & KOLONG MEJA - G
                        7, // BOX HP DAN PANGGIL GURU - H
                        8, // MENYAPU (first) - I
                        9, // MENYAPU (second) - J
                        10, // MENGEPEL (first) - K
                        11  // MENGEPEL (second) - L
                    ];

                    const currentTaskColumnIndex = columnIndicesForTasksInRow[index];
                    let petugasName = relevantPiketRow[currentTaskColumnIndex];

                    if (petugasName === undefined || petugasName === null || petugasName.trim() === '') {
                        petugasName = 'N/A';
                    }

                    petugasCell.textContent = petugasName;
                });
            } else {
                piketTableBody.innerHTML = '<tr><td colspan="2">Tidak ada data piket untuk hari ini.</td></tr>';
            }
        }

        // Fetch data when the page loads
        fetchCSVData();
    </script>
</body>
</html>
